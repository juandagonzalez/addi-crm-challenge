{"ast":null,"code":"import _objectSpread from \"/Users/davidgonzalez/Downloads/addi-crm-challenge/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";\nvar _s = $RefreshSig$();\nimport { useCallback, useMemo, useState } from \"react\";\nimport { nationalRegistryCheck, judicialRecordsCheck, internalScoring } from \"../services/validationService\";\nexport function useLeadValidation(log) {\n  _s();\n  const [busyMap, setBusyMap] = useState({});\n  const [validationStatus, setValidationStatus] = useState({});\n  const anyValidating = useMemo(() => Object.values(busyMap).some(v => v === \"validating\"), [busyMap]);\n  const validateLead = useCallback(async (lead, onSuccess, onFailure) => {\n    if (!lead || !lead.id) return;\n    const leadId = lead.id;\n    setBusyMap(m => _objectSpread(_objectSpread({}, m), {}, {\n      [leadId]: \"validating\"\n    }));\n    setValidationStatus(prev => _objectSpread(_objectSpread({}, prev), {}, {\n      [leadId]: {\n        nationalOk: false,\n        judicialOk: false,\n        scoringOk: false,\n        running: true\n      }\n    }));\n    if (log) {\n      log(\"Validating \".concat(lead.id, \" - \").concat(lead.firstName, \" \").concat(lead.lastName));\n    }\n    try {\n      const [nationalRes, judicialRes] = await Promise.allSettled([nationalRegistryCheck(lead), judicialRecordsCheck(lead)]);\n      const nationalOk = nationalRes.status === \"fulfilled\" ? !!nationalRes.value.ok : false;\n      const judicialOk = judicialRes.status === \"fulfilled\" ? !!judicialRes.value.ok : false;\n      const scoringRes = await internalScoring({\n        nationalOk,\n        judicialOk\n      }, {\n        rng: Math.random\n      });\n      const scoringOk = !!scoringRes.ok;\n      const allPass = nationalOk && judicialOk && scoringOk;\n      setValidationStatus(prev => _objectSpread(_objectSpread({}, prev), {}, {\n        [leadId]: {\n          nationalOk,\n          judicialOk,\n          scoringOk,\n          running: false\n        }\n      }));\n      if (allPass) {\n        if (log) {\n          log(\"Converted \".concat(lead.id, \" to Prospect\"));\n        }\n        if (onSuccess) {\n          onSuccess(scoringRes.score);\n        }\n        setValidationStatus(prev => {\n          const copy = _objectSpread({}, prev);\n          delete copy[leadId];\n          return copy;\n        });\n      } else {\n        if (log) {\n          log(\"Validation failed for \".concat(lead.id));\n        }\n        if (onFailure) {\n          onFailure();\n        }\n      }\n    } catch (err) {\n      if (log) {\n        log(\"Unexpected error: \".concat(err && err.message || String(err)));\n      }\n      setValidationStatus(prev => _objectSpread(_objectSpread({}, prev), {}, {\n        [leadId]: {\n          nationalOk: false,\n          judicialOk: false,\n          scoringOk: false,\n          running: false\n        }\n      }));\n      if (onFailure) {\n        onFailure();\n      }\n    } finally {\n      setBusyMap(m => _objectSpread(_objectSpread({}, m), {}, {\n        [leadId]: \"idle\"\n      }));\n    }\n  }, [log]);\n  return {\n    busyMap,\n    validationStatus,\n    anyValidating,\n    validateLead\n  };\n}\n_s(useLeadValidation, \"dR/dHbdTf3hydM5izWzFJ9SGGuU=\");","map":{"version":3,"names":["useCallback","useMemo","useState","nationalRegistryCheck","judicialRecordsCheck","internalScoring","useLeadValidation","log","_s","busyMap","setBusyMap","validationStatus","setValidationStatus","anyValidating","Object","values","some","v","validateLead","lead","onSuccess","onFailure","id","leadId","m","_objectSpread","prev","nationalOk","judicialOk","scoringOk","running","concat","firstName","lastName","nationalRes","judicialRes","Promise","allSettled","status","value","ok","scoringRes","rng","Math","random","allPass","score","copy","err","message","String"],"sources":["/Users/davidgonzalez/Downloads/addi-crm-challenge/src/hooks/useLeadValidation.js"],"sourcesContent":["import { useCallback, useMemo, useState } from \"react\";\nimport {\n  nationalRegistryCheck,\n  judicialRecordsCheck,\n  internalScoring,\n} from \"../services/validationService\";\n\nexport function useLeadValidation(log) {\n  const [busyMap, setBusyMap] = useState({});\n  const [validationStatus, setValidationStatus] = useState({});\n\n  const anyValidating = useMemo(\n    () => Object.values(busyMap).some((v) => v === \"validating\"),\n    [busyMap]\n  );\n\n  const validateLead = useCallback(\n    async (lead, onSuccess, onFailure) => {\n      if (!lead || !lead.id) return;\n      const leadId = lead.id;\n\n      setBusyMap((m) => ({ ...m, [leadId]: \"validating\" }));\n      setValidationStatus((prev) => ({\n        ...prev,\n        [leadId]: {\n          nationalOk: false,\n          judicialOk: false,\n          scoringOk: false,\n          running: true,\n        },\n      }));\n\n      if (log) {\n        log(`Validating ${lead.id} - ${lead.firstName} ${lead.lastName}`);\n      }\n\n      try {\n        const [nationalRes, judicialRes] = await Promise.allSettled([\n          nationalRegistryCheck(lead),\n          judicialRecordsCheck(lead),\n        ]);\n\n        const nationalOk =\n          nationalRes.status === \"fulfilled\" ? !!nationalRes.value.ok : false;\n        const judicialOk =\n          judicialRes.status === \"fulfilled\" ? !!judicialRes.value.ok : false;\n\n        const scoringRes = await internalScoring(\n          { nationalOk, judicialOk },\n          { rng: Math.random }\n        );\n\n        const scoringOk = !!scoringRes.ok;\n        const allPass = nationalOk && judicialOk && scoringOk;\n\n        setValidationStatus((prev) => ({\n          ...prev,\n          [leadId]: {\n            nationalOk,\n            judicialOk,\n            scoringOk,\n            running: false,\n          },\n        }));\n\n        if (allPass) {\n          if (log) {\n            log(`Converted ${lead.id} to Prospect`);\n          }\n          if (onSuccess) {\n            onSuccess(scoringRes.score);\n          }\n          setValidationStatus((prev) => {\n            const copy = { ...prev };\n            delete copy[leadId];\n            return copy;\n          });\n        } else {\n          if (log) {\n            log(`Validation failed for ${lead.id}`);\n          }\n          if (onFailure) {\n            onFailure();\n          }\n        }\n      } catch (err) {\n        if (log) {\n          log(`Unexpected error: ${(err && err.message) || String(err)}`);\n        }\n        setValidationStatus((prev) => ({\n          ...prev,\n          [leadId]: {\n            nationalOk: false,\n            judicialOk: false,\n            scoringOk: false,\n            running: false,\n          },\n        }));\n        if (onFailure) {\n          onFailure();\n        }\n      } finally {\n        setBusyMap((m) => ({ ...m, [leadId]: \"idle\" }));\n      }\n    },\n    [log]\n  );\n\n  return {\n    busyMap,\n    validationStatus,\n    anyValidating,\n    validateLead,\n  };\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}