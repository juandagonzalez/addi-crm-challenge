{"ast":null,"code":"const API_LATENCY_BASE = 2000;\nconst API_LATENCY_JITTER = 500;\nfunction delay(ms) {\n  return new Promise(res => setTimeout(res, ms));\n}\nfunction randRange(min, max) {\n  return Math.floor(Math.random() * (max - min + 1)) + min;\n}\nfunction getConfiguredLatency() {\n  let baseMultiplier = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 1;\n  const base = API_LATENCY_BASE * baseMultiplier;\n  const jitter = randRange(-API_LATENCY_JITTER, API_LATENCY_JITTER);\n  return Math.max(0, base + jitter);\n}\nexport async function nationalRegistryCheck(lead) {\n  let opts = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n  const {\n    latency = [getConfiguredLatency(1), getConfiguredLatency(1)],\n    failureRate = 0.1\n  } = opts;\n  const ms = randRange(latency[0], latency[1]);\n  await delay(ms);\n  const exists = !!(lead.nationalId && lead.birthdate && lead.firstName && lead.lastName && lead.email);\n  if (Math.random() < failureRate) {\n    throw new Error(\"National registry service unavailable\");\n  }\n  const mismatch = Math.random() < 0.05 ? \"Random mismatch\" : null;\n  if (!exists || mismatch) {\n    return {\n      ok: false,\n      reason: mismatch || \"Record not found or incomplete\"\n    };\n  }\n  return {\n    ok: true\n  };\n}\nexport async function judicialRecordsCheck(lead) {\n  let opts = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n  const {\n    latency = [getConfiguredLatency(1), getConfiguredLatency(1)],\n    hitRate = 0.15,\n    failureRate = 0.08\n  } = opts;\n  const ms = randRange(latency[0], latency[1]);\n  await delay(ms);\n  if (Math.random() < failureRate) {\n    throw new Error(\"Judicial records service timeout\");\n  }\n  const hasRecords = Math.random() < hitRate;\n  return {\n    ok: !hasRecords,\n    hasRecords\n  };\n}\nexport async function internalScoring(prereqResults) {\n  let opts = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n  const {\n    latency = [getConfiguredLatency(1), getConfiguredLatency(1)],\n    rng = Math.random\n  } = opts;\n  const ms = randRange(latency[0], latency[1]);\n  await delay(ms);\n  if (!(prereqResults !== null && prereqResults !== void 0 && prereqResults.nationalOk) || !(prereqResults !== null && prereqResults !== void 0 && prereqResults.judicialOk)) {\n    return {\n      ok: false,\n      score: 0,\n      reason: \"Prerequisites failed\"\n    };\n  }\n  const score = Math.round(rng() * 100);\n  return {\n    ok: score > 60,\n    score\n  };\n}","map":{"version":3,"names":["API_LATENCY_BASE","API_LATENCY_JITTER","delay","ms","Promise","res","setTimeout","randRange","min","max","Math","floor","random","getConfiguredLatency","baseMultiplier","arguments","length","undefined","base","jitter","nationalRegistryCheck","lead","opts","latency","failureRate","exists","nationalId","birthdate","firstName","lastName","email","Error","mismatch","ok","reason","judicialRecordsCheck","hitRate","hasRecords","internalScoring","prereqResults","rng","nationalOk","judicialOk","score","round"],"sources":["/Users/davidgonzalez/Downloads/addi-crm-challenge/src/services/validationService.js"],"sourcesContent":["const API_LATENCY_BASE = 2000;\nconst API_LATENCY_JITTER = 500;\n\nfunction delay(ms) {\n  return new Promise((res) => setTimeout(res, ms));\n}\n\nfunction randRange(min, max) {\n  return Math.floor(Math.random() * (max - min + 1)) + min;\n}\n\nfunction getConfiguredLatency(baseMultiplier = 1) {\n  const base = API_LATENCY_BASE * baseMultiplier;\n  const jitter = randRange(-API_LATENCY_JITTER, API_LATENCY_JITTER);\n  return Math.max(0, base + jitter);\n}\n\nexport async function nationalRegistryCheck(lead, opts = {}) {\n  const {\n    latency = [getConfiguredLatency(1), getConfiguredLatency(1)],\n    failureRate = 0.1,\n  } = opts;\n\n  const ms = randRange(latency[0], latency[1]);\n  await delay(ms);\n\n  const exists = !!(\n    lead.nationalId &&\n    lead.birthdate &&\n    lead.firstName &&\n    lead.lastName &&\n    lead.email\n  );\n\n  if (Math.random() < failureRate) {\n    throw new Error(\"National registry service unavailable\");\n  }\n\n  const mismatch = Math.random() < 0.05 ? \"Random mismatch\" : null;\n\n  if (!exists || mismatch) {\n    return {\n      ok: false,\n      reason: mismatch || \"Record not found or incomplete\",\n    };\n  }\n\n  return { ok: true };\n}\n\nexport async function judicialRecordsCheck(lead, opts = {}) {\n  const {\n    latency = [getConfiguredLatency(1), getConfiguredLatency(1)],\n    hitRate = 0.15,\n    failureRate = 0.08,\n  } = opts;\n\n  const ms = randRange(latency[0], latency[1]);\n  await delay(ms);\n\n  if (Math.random() < failureRate) {\n    throw new Error(\"Judicial records service timeout\");\n  }\n\n  const hasRecords = Math.random() < hitRate;\n  return { ok: !hasRecords, hasRecords };\n}\n\nexport async function internalScoring(prereqResults, opts = {}) {\n  const {\n    latency = [getConfiguredLatency(1), getConfiguredLatency(1)],\n    rng = Math.random,\n  } = opts;\n\n  const ms = randRange(latency[0], latency[1]);\n  await delay(ms);\n\n  if (!prereqResults?.nationalOk || !prereqResults?.judicialOk) {\n    return { ok: false, score: 0, reason: \"Prerequisites failed\" };\n  }\n\n  const score = Math.round(rng() * 100);\n  return { ok: score > 60, score };\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}